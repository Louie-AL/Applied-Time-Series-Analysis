"0",""
"0","library(astsa)"
"0",""
"0","# Function to Calculate Likelihood "
"0","Linn <- function(para){"
"0",""
"0",""
"0"," Phi <- diag(0,3) "
"0"," phi_1 <- para[1]"
"0"," Theta_1 <- para[2]"
"0"," Phi[1,1] <- 1"
"0"," Phi[1,2] <- 1"
"0"," Phi[1,3] <- Theta_1"
"0"," Phi[2,1] <- 0"
"0"," Phi[2,2] <- phi_1"
"0"," Phi[2,3] <- 0"
"0"," Phi[3,] <- c(0,1,0);"
"0",""
"0"," A <- cbind(1,1,Theta_1)"
"0",""
"0"," sigma_Z <- para[3] # sqrt sigma_Z^2"
"0"," QQ <- diag(0,3)"
"0"," QQ[1,] <- c(0,0,0)"
"0"," QQ[2,1] <- 0"
"0"," QQ[2,2] <- sigma_Z"
"0"," QQ[2,3] <- 0"
"0"," QQ[3,] <- c(0,0,0)"
"0"," "
"0"," RR <- 0"
"0"," "
"0"," kf <- Kfilter(ts.e1, A, mu0, Sigma0, Phi, QQ, RR,"
"0","              Ups=NULL, Gam=NULL,input=NULL,S=NULL,version=1)"
"0"," return(kf$like)"
"0",""
"0","}"
"0",""
"0","# Kfilter"
"0",""
"0","# Initial Parameters "
"0","mu0      <- c(y[1],0,0) "
"0","Sigma0   <- diag(1,3)  "
"0","init.par <- c(0.58, 0.6044, sqrt(1.77))  # G[1,1], the 2 Rs and Q"
"0",""
"0","# Estimation"
"0","est <- optim(init.par, Linn, NULL, method=""BFGS"", hessian=TRUE, control=list(trace=0,REPORT=1))"
"0","SE  <- sqrt(diag(solve(est$hessian)))"
"0","u   <- cbind(estimate=est$par,SE)"
"0","rownames(u)=c(""Phi1"",""Theta1"",""sigz2""); u     "
"1","      "
"1","  estimate"
"1","         SE"
"1","
Phi1  "
"1"," 0.5837906"
"1"," 0.07204385"
"1","
Theta1"
"1"," 0.6009904"
"1"," 0.08928380"
"1","
sigz2 "
"1"," 1.3237167"
"1"," 0.06615694"
"1","
"
"0","est"
"1","$par
"
"1","[1]"
"1"," 0.5837906"
"1"," 0.6009904"
"1"," 1.3237167"
"1","
"
"1","
"
"1","$value
"
"1","[1]"
"1"," 157.5489"
"1","
"
"1","
"
"1","$counts
"
"1","function "
"1","gradient "
"1","
"
"1","      23 "
"1","       6 "
"1","
"
"1","
"
"1","$convergence
"
"1","[1]"
"1"," 0"
"1","
"
"1","
"
"1","$message
"
"1","NULL
"
"1","
"
"1","$hessian
"
"1","    "
"1","        [,1]"
"1","       [,2]"
"1","        [,3]"
"1","
[1,]"
"1"," 300.6356896"
"1"," 145.380729"
"1","   0.7811095"
"1","
[2,]"
"1"," 145.3807291"
"1"," 195.758786"
"1","   1.9282564"
"1","
[3,]"
"1","   0.7811095"
"1","   1.928256"
"1"," 228.5017488"
"1","
"
"1","
"
"0","# Ksmooth"
"0",""
"0","# Smoothing"
"0",""
"0","Phi <- diag(0,3) "
"0","Phi[1,1] <- 1"
"0","Phi[1,2] <- 1"
"0","Phi[1,3] <- est$par[2]"
"0","Phi[2,1] <- 0"
"0","Phi[2,2] <- est$par[1]"
"0","Phi[2,3] <- 0"
"0","Phi[3,] <- c(0,1,0);"
"0",""
"0","A <- cbind(1,1,est$par[2])"
"0",""
"0","QQ <- diag(0,3)"
"0","QQ[1,] <- c(0,0,0)"
"0","QQ[2,1] <- 0"
"0","QQ[2,2] <- est$par[3]"
"0","QQ[2,3] <- 0"
"0","QQ[3,] <- c(0,0,0)"
"0",""
"0","RR <- 0.0000001"
"0",""
"0","ks <- Ksmooth(ts.e1, A, mu0, Sigma0, Phi, QQ, RR)   "
"0",""
"0","# Plots"
"0","Tsm   <- ts(as.numeric(ks$Xs[1,,]))"
"0","Ssm   <- ts(as.numeric(ks$Xs[2,,]))"
"0","p1    <- 3*sqrt(ks$Ps[1,1,]); p2 = 3*sqrt(ks$Ps[2,2,])"
"0","par(mfrow=c(2,1))"
"0","tsplot(Tsm, main='Trend Component', ylab='Trend')"
