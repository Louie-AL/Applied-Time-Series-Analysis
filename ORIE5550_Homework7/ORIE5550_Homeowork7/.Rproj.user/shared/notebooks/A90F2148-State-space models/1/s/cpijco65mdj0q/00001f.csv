"0","library(astsa)"
"0",""
"0","A <- cbind(1,1,0,0) "
"0",""
"0","# Function to Calculate Likelihood "
"0","Linn <- function(para){"
"0"," Phi <- diag(0,4) "
"0"," Phi[1,1] <- para[1] "
"0"," Phi[2,] <- c(0,-1,-1,-1); "
"0"," Phi[3,] <- c(0,1,0,0); "
"0"," Phi[4,] <- c(0,0,1,0);"
"0"," Q1 <- para[2]; Q2 <- para[3]   # sqrt q11 and q22"
"0"," QQ <- diag(0,4); QQ[1,1] <- Q1; QQ[2,2] <- Q2"
"0"," RR <- para[4] # sqrt r11"
"0"," kf <- Kfilter(jj, A, mu0, Sigma0, Phi, QQ, RR,"
"0","              Ups=NULL, Gam=NULL,input=NULL,S=NULL,version=1)"
"0"," return(kf$like)  "
"0","}"
"0",""
"0","# Kfilter"
"0",""
"0","# Initial Parameters "
"0","mu0      <- c(0.7,0,0,0) "
"0","Sigma0   <- diag(0.04,4)  "
"0","init.par <- c(1.03, 0.1, 0.1, 0.5)  # G[1,1], the 2 Rs and Q"
"0",""
"0","# Estimation"
"0","est <- optim(init.par, Linn, NULL, method=""BFGS"", hessian=TRUE, control=list(trace=0,REPORT=1))"
"0","SE  <- sqrt(diag(solve(est$hessian)))"
"0","u   <- cbind(estimate=est$par,SE)"
"0","rownames(u)=c(""Phi11"",""sigw1"",""sigw2"",""sigv""); u     "
"1","     "
"1","    estimate"
"1","         SE"
"1","
Phi11"
"1"," 1.035084765"
"1"," 0.00253645"
"1","
sigw1"
"1"," 0.139725568"
"1"," 0.02155155"
"1","
sigw2"
"1"," 0.220878294"
"1"," 0.02376430"
"1","
sigv "
"1"," 0.000465594"
"1"," 0.24174778"
"1","
"
"0","# Ksmooth"
"0",""
"0","# Smooth"
"0","Phi      <- diag(0,4) "
"0","Phi[1,1] <- est$par[1] "
"0","Phi[2,]  <- c(0,-1,-1,-1) "
"0","Phi[3,]  <- c(0,1,0,0) "
"0","Phi[4,]  <- c(0,0,1,0)"
"0","Q1      <- est$par[2]"
"0","Q2      <- est$par[3]      "
"0","QQ       <- diag(0,4)"
"0","QQ[1,1]  <- Q1"
"0","QQ[2,2]  <- Q2"
"0","RR       <- est$par[4]"
"0","ks       <- Ksmooth(jj, A, mu0, Sigma0, Phi, QQ, RR)   "
"0",""
"0","# Plots"
"0","Tsm   <- ts(as.numeric(ks$Xs[1,,]), start=1960, freq=4)"
"0","Ssm   <- ts(as.numeric(ks$Xs[2,,]), start=1960, freq=4)"
"0","p1    <- 3*sqrt(ks$Ps[1,1,]); p2 = 3*sqrt(ks$Ps[2,2,])"
"0","par(mfrow=c(2,1))"
"0","tsplot(Tsm, main='Trend Component', ylab='Trend')"
